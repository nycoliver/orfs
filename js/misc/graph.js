var node_data = {"0":{"x":295.75506591796875,"y":346.4582214355469},"1":{"x":238.68545532226562,"y":380.7445983886719},"2":{"x":553.3278198242188,"y":410.8551940917969},"3":{"x":553.9080810546875,"y":684.4034423828125},"4":{"x":464.4071960449219,"y":568.76513671875},"5":{"x":500.4756164550781,"y":564.66357421875},"6":{"x":632.261474609375,"y":558.7320556640625},"7":{"x":264.6531982421875,"y":472.0436706542969},"8":{"x":386.61846923828125,"y":480.32958984375},"9":{"x":390.40185546875,"y":145.01275634765625},"10":{"x":542.0798950195312,"y":489.1390075683594},"11":{"x":631.9190673828125,"y":534.5088500976562},"12":{"x":464.8403625488281,"y":367.3373718261719},"13":{"x":666.9264526367188,"y":450.9747009277344},"14":{"x":696.8469848632812,"y":644.0216064453125},"15":{"x":511.66943359375,"y":362.7317810058594},"16":{"x":232.72666931152344,"y":535.7399291992188},"17":{"x":398.6322937011719,"y":507.2145690917969},"18":{"x":489.9368591308594,"y":240.2460174560547},"19":{"x":498.09033203125,"y":589.8291625976562},"20":{"x":607.7532348632812,"y":350.9587097167969},"21":{"x":298.6866760253906,"y":414.7047424316406},"22":{"x":367.0381774902344,"y":486.8582763671875},"23":{"x":639.2781982421875,"y":325.8824157714844},"24":{"x":371.936279296875,"y":545.029296875},"25":{"x":432.46038818359375,"y":628.096923828125},"26":{"x":592.6913452148438,"y":547.7359619140625},"27":{"x":376.6463623046875,"y":604.038818359375},"28":{"x":569.9050903320312,"y":408.6031188964844},"29":{"x":343.34423828125,"y":520.8076171875},"30":{"x":686.08984375,"y":256.54876708984375},"31":{"x":522.987060546875,"y":450.1527099609375},"32":{"x":498.5955505371094,"y":536.274169921875},"33":{"x":522.2278442382812,"y":502.1697082519531},"34":{"x":676.4963989257812,"y":135.72959899902344},"35":{"x":444.3667907714844,"y":856.2623291015625},"36":{"x":490.1309814453125,"y":474.8652648925781},"37":{"x":233.19369506835938,"y":427.57562255859375},"38":{"x":646.0714721679688,"y":371.998291015625},"39":{"x":686.2616577148438,"y":352.68756103515625},"40":{"x":404.6350402832031,"y":363.666748046875},"41":{"x":388.2833251953125,"y":680.51904296875},"42":{"x":351.7972412109375,"y":447.0267639160156},"43":{"x":456.3043212890625,"y":236.89505004882812},"44":{"x":439.873291015625,"y":533.70458984375},"45":{"x":632.6651000976562,"y":216.1242218017578},"46":{"x":383.67742919921875,"y":379.63690185546875},"47":{"x":497.6095275878906,"y":390.1812744140625},"48":{"x":703.1637573242188,"y":437.8011169433594},"49":{"x":471.38067626953125,"y":416.2927551269531},"50":{"x":567.9085083007812,"y":478.8866882324219},"51":{"x":570.5706176757812,"y":494.6586608886719},"52":{"x":584.6465454101562,"y":491.414306640625},"53":{"x":575.2401733398438,"y":510.67962646484375},"54":{"x":485.647705078125,"y":645.1224365234375},"55":{"x":413.9508361816406,"y":479.74310302734375},"56":{"x":230.21923828125,"y":263.4263610839844},"57":{"x":270.2161865234375,"y":389.8159484863281},"58":{"x":546.0968627929688,"y":641.4921264648438},"59":{"x":653.3396606445312,"y":500.7887268066406},"60":{"x":266.10955810546875,"y":504.54071044921875},"61":{"x":589.3494873046875,"y":336.83935546875},"62":{"x":528.0105590820312,"y":405.2428894042969},"63":{"x":456.2046203613281,"y":637.318359375},"64":{"x":520.3908081054688,"y":554.8011474609375},"65":{"x":667.4306030273438,"y":241.07322692871094},"66":{"x":696.8182373046875,"y":393.613525390625},"67":{"x":439.0296936035156,"y":787.5150756835938},"68":{"x":388.7645263671875,"y":587.3214111328125},"69":{"x":541.88525390625,"y":566.6279296875},"70":{"x":709.843505859375,"y":415.9816589355469},"71":{"x":195.5152130126953,"y":314.5452880859375},"72":{"x":192.3113250732422,"y":602.5093994140625},"73":{"x":594.928466796875,"y":433.1842041015625},"74":{"x":588.7996215820312,"y":456.2137451171875},"75":{"x":561.2791748046875,"y":620.39013671875},"76":{"x":327.2940368652344,"y":349.2492980957031},"77":{"x":410.7186584472656,"y":442.0777282714844},"78":{"x":447.14251708984375,"y":132.6689453125},"79":{"x":425.8791809082031,"y":278.521484375},"80":{"x":588.349365234375,"y":506.324951171875},"81":{"x":655.4815063476562,"y":463.02008056640625},"82":{"x":968.34375,"y":358.4200439453125},"83":{"x":643.1443481445312,"y":73.16475677490234},"84":{"x":509.21710205078125,"y":313.0069274902344},"85":{"x":330.2446594238281,"y":-33.05802536010742},"86":{"x":525.7232055664062,"y":694.102294921875},"87":{"x":606.0087890625,"y":389.7469787597656},"88":{"x":321.1134948730469,"y":580.1841430664062},"89":{"x":558.0700073242188,"y":549.6130981445312},"90":{"x":612.8119506835938,"y":284.1722106933594},"91":{"x":454.7410583496094,"y":274.0997619628906},"92":{"x":315.9493103027344,"y":458.3404846191406},"93":{"x":355.59429931640625,"y":357.15313720703125},"94":{"x":609.5606689453125,"y":584.704345703125},"95":{"x":735.2255859375,"y":191.5644073486328},"96":{"x":503.53387451171875,"y":136.57142639160156},"97":{"x":174.4427947998047,"y":353.4833679199219},"98":{"x":515.971435546875,"y":649.361328125},"99":{"x":638.507080078125,"y":154.1005401611328},"100":{"x":503.4054870605469,"y":494.8798828125},"101":{"x":445.1539001464844,"y":455.09490966796875},"102":{"x":315.0466613769531,"y":535.7095336914062},"103":{"x":486.8943176269531,"y":440.75457763671875},"104":{"x":273.1800842285156,"y":553.6265869140625},"105":{"x":348.01702880859375,"y":269.5907897949219},"106":{"x":149.51304626464844,"y":402.96820068359375},"107":{"x":666.8504638671875,"y":329.7801818847656},"108":{"x":393.9013671875,"y":404.4898986816406},"109":{"x":567.4703369140625,"y":580.4627685546875},"110":{"x":333.40728759765625,"y":232.4925537109375},"111":{"x":442.7735900878906,"y":607.805908203125},"112":{"x":496.1360168457031,"y":694.2182006835938},"113":{"x":386.06024169921875,"y":329.4561767578125},"114":{"x":339.1903991699219,"y":385.39129638671875},"115":{"x":627.66162109375,"y":439.564697265625},"116":{"x":147.73365783691406,"y":436.9982604980469},"117":{"x":554.3302612304688,"y":457.3728332519531},"118":{"x":563.0269775390625,"y":294.15087890625},"119":{"x":599.2953491210938,"y":638.2169189453125},"120":{"x":447.2294921875,"y":696.183349609375},"121":{"x":435.4900817871094,"y":358.1603088378906},"122":{"x":464.4720458984375,"y":494.0268859863281},"123":{"x":423.0066223144531,"y":244.49830627441406},"124":{"x":372.5010681152344,"y":400.6356506347656},"125":{"x":391.1494140625,"y":436.0771789550781},"126":{"x":802.0017700195312,"y":422.5995788574219},"127":{"x":738.5576171875,"y":592.873779296875},"128":{"x":418.2032165527344,"y":386.3222351074219},"129":{"x":527.7100830078125,"y":330.6636047363281},"130":{"x":484.3521728515625,"y":272.57379150390625}};

var edge_data = [{"source":18,"target":96},{"source":118,"target":129},{"source":49,"target":129},{"source":62,"target":129},{"source":128,"target":125},{"source":128,"target":12},{"source":48,"target":126},{"source":113,"target":125},{"source":22,"target":125},{"source":125,"target":76},{"source":92,"target":125},{"source":0,"target":125},{"source":24,"target":125},{"source":40,"target":125},{"source":17,"target":125},{"source":8,"target":125},{"source":36,"target":125},{"source":93,"target":125},{"source":114,"target":125},{"source":21,"target":125},{"source":57,"target":125},{"source":101,"target":125},{"source":100,"target":125},{"source":124,"target":12},{"source":124,"target":22},{"source":9,"target":123},{"source":12,"target":123},{"source":117,"target":122},{"source":32,"target":122},{"source":33,"target":122},{"source":100,"target":122},{"source":77,"target":122},{"source":101,"target":121},{"source":67,"target":120},{"source":120,"target":54},{"source":120,"target":98},{"source":44,"target":120},{"source":120,"target":25},{"source":120,"target":63},{"source":64,"target":119},{"source":118,"target":62},{"source":117,"target":81},{"source":117,"target":100},{"source":117,"target":73},{"source":117,"target":90},{"source":117,"target":64},{"source":116,"target":37},{"source":115,"target":50},{"source":52,"target":115},{"source":115,"target":53},{"source":80,"target":115},{"source":115,"target":51},{"source":61,"target":115},{"source":37,"target":114},{"source":12,"target":114},{"source":113,"target":12},{"source":113,"target":110},{"source":113,"target":76},{"source":111,"target":4},{"source":111,"target":64},{"source":19,"target":111},{"source":111,"target":24},{"source":99,"target":45},{"source":99,"target":83},{"source":99,"target":90},{"source":109,"target":100},{"source":108,"target":37},{"source":108,"target":28},{"source":38,"target":107},{"source":107,"target":28},{"source":105,"target":40},{"source":104,"target":72},{"source":104,"target":8},{"source":12,"target":103},{"source":101,"target":103},{"source":32,"target":103},{"source":17,"target":102},{"source":22,"target":102},{"source":101,"target":40},{"source":101,"target":15},{"source":101,"target":100},{"source":101,"target":8},{"source":101,"target":36},{"source":101,"target":33},{"source":101,"target":46},{"source":42,"target":101},{"source":101,"target":128},{"source":101,"target":22},{"source":17,"target":101},{"source":100,"target":73},{"source":74,"target":100},{"source":17,"target":100},{"source":100,"target":51},{"source":64,"target":100},{"source":52,"target":100},{"source":94,"target":100},{"source":89,"target":100},{"source":80,"target":100},{"source":6,"target":100},{"source":100,"target":69},{"source":26,"target":100},{"source":100,"target":53},{"source":100,"target":22},{"source":100,"target":50},{"source":100,"target":31},{"source":100,"target":28},{"source":100,"target":62},{"source":100,"target":4},{"source":19,"target":100},{"source":64,"target":98},{"source":19,"target":98},{"source":5,"target":98},{"source":57,"target":97},{"source":71,"target":97},{"source":95,"target":30},{"source":26,"target":94},{"source":94,"target":14},{"source":93,"target":12},{"source":1,"target":93},{"source":17,"target":92},{"source":92,"target":22},{"source":57,"target":92},{"source":91,"target":12},{"source":89,"target":32},{"source":89,"target":10},{"source":17,"target":88},{"source":19,"target":86},{"source":84,"target":12},{"source":84,"target":62},{"source":81,"target":73},{"source":80,"target":33},{"source":80,"target":32},{"source":80,"target":73},{"source":12,"target":79},{"source":43,"target":78},{"source":77,"target":29},{"source":77,"target":12},{"source":32,"target":75},{"source":73,"target":36},{"source":73,"target":51},{"source":73,"target":62},{"source":52,"target":73},{"source":73,"target":50},{"source":20,"target":73},{"source":73,"target":53},{"source":66,"target":73},{"source":73,"target":31},{"source":73,"target":13},{"source":61,"target":73},{"source":73,"target":28},{"source":38,"target":73},{"source":71,"target":57},{"source":73,"target":70},{"source":70,"target":13},{"source":33,"target":69},{"source":68,"target":4},{"source":17,"target":68},{"source":35,"target":67},{"source":95,"target":65},{"source":58,"target":64},{"source":64,"target":36},{"source":64,"target":31},{"source":64,"target":4},{"source":64,"target":10},{"source":19,"target":64},{"source":64,"target":54},{"source":64,"target":33},{"source":4,"target":63},{"source":32,"target":63},{"source":27,"target":63},{"source":19,"target":63},{"source":41,"target":63},{"source":25,"target":63},{"source":33,"target":62},{"source":12,"target":62},{"source":61,"target":45},{"source":61,"target":65},{"source":61,"target":30},{"source":61,"target":38},{"source":61,"target":2},{"source":61,"target":12},{"source":29,"target":60},{"source":16,"target":60},{"source":7,"target":60},{"source":37,"target":60},{"source":22,"target":60},{"source":59,"target":33},{"source":59,"target":48},{"source":58,"target":19},{"source":55,"target":27},{"source":55,"target":12},{"source":55,"target":22},{"source":98,"target":54},{"source":19,"target":54},{"source":33,"target":53},{"source":32,"target":53},{"source":52,"target":33},{"source":52,"target":32},{"source":33,"target":51},{"source":32,"target":51},{"source":33,"target":50},{"source":32,"target":50},{"source":12,"target":49},{"source":33,"target":49},{"source":125,"target":49},{"source":48,"target":2},{"source":45,"target":34},{"source":44,"target":12},{"source":43,"target":12},{"source":27,"target":41},{"source":41,"target":25},{"source":40,"target":12},{"source":28,"target":39},{"source":38,"target":39},{"source":38,"target":28},{"source":37,"target":106},{"source":1,"target":37},{"source":47,"target":36},{"source":19,"target":36},{"source":32,"target":36},{"source":5,"target":36},{"source":12,"target":36},{"source":19,"target":33},{"source":11,"target":33},{"source":33,"target":31},{"source":33,"target":28},{"source":4,"target":33},{"source":32,"target":2},{"source":32,"target":29},{"source":32,"target":25},{"source":19,"target":32},{"source":31,"target":2},{"source":87,"target":31},{"source":5,"target":31},{"source":12,"target":31},{"source":16,"target":29},{"source":28,"target":23},{"source":27,"target":8},{"source":24,"target":27},{"source":27,"target":25},{"source":19,"target":25},{"source":4,"target":25},{"source":7,"target":22},{"source":20,"target":15},{"source":19,"target":112},{"source":19,"target":3},{"source":19,"target":4},{"source":12,"target":18},{"source":7,"target":16},{"source":12,"target":15},{"source":10,"target":13},{"source":12,"target":2},{"source":12,"target":130},{"source":12,"target":8},{"source":101,"target":10},{"source":7,"target":29},{"source":7,"target":1},{"source":6,"target":127},{"source":5,"target":54},{"source":0,"target":56}]


window.$ = window.jQuery = require('./js/jquery-2.1.4.min.js');


$(function () {
  var nnodes = node_data;
  var eedges = edge_data;

  var min_x = Number.MAX_VALUE;
  var max_x = 0;
  var min_y = Number.MAX_VALUE;
  var max_y = 0;

  for (var i = 0; i < Object.keys(nnodes).length; i++) {
    min_x = Math.min(min_x, nnodes[i].x);
    max_x = Math.max(max_x, nnodes[i].x);
    min_y = Math.min(min_y, nnodes[i].y);
    max_y = Math.max(max_y, nnodes[i].y);
  }

  var new_scale_x = d3.scale.linear().domain([min_x, max_x]).range([(window.innerWidth*.25-(window.innerWidth*.025)), (window.innerWidth*.025)]);

  var new_scale_y = d3.scale.linear().domain([min_y, max_y]).range([window.innerHeight*.6, 80]);
  for (var i = 0; i < Object.keys(nnodes).length; i++) {
    nnodes[i].x = new_scale_x(nnodes[i].x);
    nnodes[i].y = new_scale_y(nnodes[i].y);
  }

  //Run the FDEB algorithm using default values on the data
  var fbundling = d3.ForceEdgeBundling().nodes(nnodes).edges(eedges);
  var results = fbundling();

  var zoom = d3.behavior.zoom()
    .scaleExtent([1, 5])
    .on("zoom", zoomed);



  var svg = d3.select("#graph").append("svg")
    .attr("width", window.innerWidth*.25)
    .attr("height", window.innerHeight*.6)
    .call(zoom)
    .append('g');

  var d3line = d3.svg.line()
    .x(function (d) {
      return d.x;
    })
    .y(function (d) {
      return d.y;
    })
    .interpolate("linear");

  //plot the data
  for (var i = 0; i < results.length; i++) {
    svg.append("path").attr("d", d3line(results[i]))
      .attr("class", "link")
      .style("stroke-width", .5)
      .style("stroke", "black")
      .style("fill", "none")
      .style('stroke-opacity', 0.1);
  }

  var link = svg.selectAll(".link")
    .data(edge_data);

  //draw nodes
  var node = svg.selectAll('.node')
    .data(d3.entries(nnodes))
    .enter()
    .append('circle')
    .classed('node', true)
    .attr({
      'r': 1.5,
      'fill': "#121212"
    })
    .attr('cx', function (d) {
      return d.value.x;
    })
    .attr('cy', function (d) {
      return d.value.y;
    })
    .on('click', connectedNodes);

    // .on('click', selectNode);



  function selectNode() {
    d = d3.select(this).node().__data__;
  }


  // Node highlighting

  //Toggle stores whether the highlighting is on
  var selectedNode;
  var toggle = 0;
  //Create an array logging what is connected to what
  var linkedByIndex = {};
  for (i = 0; i < Object.keys(node_data).length; i++) {
       linkedByIndex[i + "," + i] = 1;
   };
   edge_data.forEach(function (d) {
       linkedByIndex[d.source + "," + d.target] = 1;
   });

   //This function looks up whether a pair are neighbours
   function neighboring(a, b) {
       return linkedByIndex[a.key + "," + b.key];
   }

   function connectedNodes() {

      d = d3.select(this).node().__data__;

       if (d.key != selectedNode) {
           //Reduce the opacity of all but the neighbouring nodes

           node.style("opacity", function (o) {
             if (d == o)
                return 1;
              else
                return neighboring(d, o) | neighboring(o, d) ? .35 : 0.1;
           });

           link.style("opacity", function (o) {
               return d.key==o.source | d.key==o.target ? 1 : 0.1;
           });

           selectedNode = d.key
       } else if (d.key == selectedNode) {
           //Put them back to opacity=1
           node.style("opacity", 1);
           link.style("opacity", 1);
           selectedNode = -1;
       }

   }

   // Zoom graph
   function zoomed() {
     svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
   }

   d3.select(window).on('resize', resize);

   function resize() {
    //  svg.attr("transform", "translate(0)scale(0)")
   }


});





// })
